{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/orders.css' %}">
{% endblock %}

{% block content %}
<div class="order-container">
  <h2>üõí {% if form.instance.pk %}Edit Order{% else %}Create Order{% endif %}</h2>

  <form method="post" id="order-form" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- Only Table field (status removed) -->
    <div class="table-number">
      <label for="{{ form.table_number.id_for_label }}">Table</label><br>
      {{ form.table_number }} {{ form.table_number.errors }}
    </div>

    <!-- 2-column layout: items grid + sticky summary -->
    <div class="order-layout">
      <section>
        <label class="section-title" style="font-weight:600;display:block;margin-bottom:8px;">Select Items:</label>

        <div class="items-grid" id="cards-grid">
          {% for item in menu_items %}
          <div class="card" data-id="{{ item.id }}" data-price="{{ item.price|floatformat:'2' }}">
            <div class="selected-badge">‚úî Selected</div>
            <input type="checkbox" class="card-check" aria-label="select {{ item.name }}">

            <img src="{{ item.image.url }}" class="menu-image" alt="{{ item.name }}">
            <h4 class="item-title">{{ item.name }}</h4>
            <p class="item-description">{{ item.description }}</p>
            <div class="price">‚Ç±{{ item.price }}</div>

            <div class="quantity-controls" style="margin-top:8px;">
              <button type="button" class="qty-btn" data-action="minus">‚àí</button>
              <input type="number" class="qty-input" value="1" min="1" disabled>
              <button type="button" class="qty-btn" data-action="plus">+</button>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>

      <aside class="summary-box">
        <h3>üßæ Order Summary</h3>
        <div class="summary-line">
          <span>Table</span>
          <strong id="summary-table">‚Äî</strong>
        </div>
        <ul id="summary-list" class="summary-list"></ul>
        <div class="summary-total">
          <span>Total</span>
          <strong id="summary-total">‚Ç±0.00</strong>
        </div>
      </aside>
    </div>

    <!-- Hidden inline formset (kept functional) -->
    {{ formset.non_field_errors }}
    {{ formset.management_form }}
    <div id="hidden-formset" style="display:none;">
      {% for f in formset.forms %}
        {{ f.id }} {{ f.menu_item }} {{ f.quantity }} {{ f.notes }}
        {% if f.fields.DELETE %}{{ f.DELETE }}{% endif %}
      {% endfor %}
    </div>

    <div class="button-row">
      <button type="submit" class="btn-primary">Submit Order</button>
      <a href="{% url 'orders:list' %}" class="btn-secondary">‚Üê Back</a>
    </div>
  </form>
</div>

<!-- External JS -->
<script src="{% static 'js/order_form.js' %}"></script>
{% endblock %}
